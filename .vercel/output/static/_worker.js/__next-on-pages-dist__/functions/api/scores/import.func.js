var W=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var J=Object.getOwnPropertyNames;var Q=Object.prototype.hasOwnProperty;var Z=(i,l)=>()=>(i&&(l=i(i=0)),l);var G=(i,l,F,y)=>{if(l&&typeof l=="object"||typeof l=="function")for(let f of J(l))!Q.call(i,f)&&f!==F&&W(i,f,{get:()=>l[f],enumerable:!(y=z(l,f))||y.enumerable});return i},X=(i,l,F)=>(G(i,l,"default"),F&&G(F,l,"default"));var ee=i=>G(W({},"__esModule",{value:!0}),i);var L={};import*as ht from"async_hooks";var V=Z(()=>{X(L,ht)});import{__getNamedExports as te}from"../../../../__next-on-pages-dist__/webpack/9802cf9bbc098bad310494fcc153465f.js";import{__getNamedExports as ne}from"../../../../__next-on-pages-dist__/manifest/27d10e462fba646daaa29468a0656e12.js";import"../../../../__next-on-pages-dist__/wasm/wasm_848bce377ad47c933e205bdb413ae8af5ac0ccf0.wasm";var A=globalThis.__nextOnPagesRoutesIsolation.getProxyFor("/api/scores/import"),t=te(A,A,A),_e=t.__chunk_1146,ae=t.__chunk_6195,re=t.__chunk_2067,se=t.__chunk_5486,oe=t.__chunk_7223,ce=t.__chunk_1548,ue=t.__chunk_2780,ie=t.__chunk_5612,de=t.__chunk_2262,le=t.__chunk_1465,he=t.__chunk_1869,pe=t.__chunk_5524,ke=t.__chunk_8536,me=t.__chunk_6765,ye=t.__chunk_9814,fe=t.__chunk_9859,ge=t.__chunk_9307,xe=t.__chunk_74,Ne=t.__chunk_4123,Ee=t.__chunk_3412,ve=t.__chunk_8978,Re=t.__chunk_1812,Te=t.__chunk_1673,we=t.__chunk_7398,be=t.__chunk_5376,Oe=t.__chunk_6617,Se=t.__chunk_5767,Ie=t.__chunk_8260,Ae=t.__chunk_5027,Pe=t.__chunk_2738,Ce=t.__chunk_2113,Me=t.__chunk_5065,Fe=t.__chunk_5514,je=t.__chunk_2860,$e=t.__chunk_5257,Le=t.__chunk_8427,De=t.__chunk_8997,He=t.__chunk_8024,Ue=t.__chunk_2403,Be=t.__chunk_8690,Ke=t.__chunk_6265,Ge=t.__chunk_5492,Xe=t.__chunk_3059,qe=t.__chunk_8610,We=t.__chunk_7959,Ve=t.__chunk_4303,Ye=t.__chunk_3326,ze=t.__chunk_391,Je=t.__chunk_8789,Qe=t.__chunk_552,Ze=t.__chunk_7649,et=t.__chunk_2501,tt=t.__chunk_6443,nt=t.__chunk_1616,_t=t.__chunk_2034,at=t.__chunk_3131,rt=t.__chunk_2328,st=t.__chunk_8908,ot=t.__chunk_1713,ct=t.__chunk_1172,q=ne(A,A,A),ut=q.__NEXT_FONT_MANIFEST,it=q.__REACT_LOADABLE_MANIFEST,dt=q.__BUILD_MANIFEST,ft=((i,l,F)=>(l._ENTRIES={},i.__BUILD_MANIFEST=dt,i.__REACT_LOADABLE_MANIFEST=it,i.__NEXT_FONT_MANIFEST=ut,i.__INTERCEPTION_ROUTE_REWRITE_MANIFEST="[]",i.__PRERENDER_MANIFEST='{"version":4,"routes":{"/":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/page,_N_T_/"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/","dataRoute":"/index.rsc"},"/scores/import":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/scores/layout,_N_T_/scores/import/layout,_N_T_/scores/import/page,_N_T_/scores/import"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/scores/import","dataRoute":"/scores/import.rsc"},"/management":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/management/layout,_N_T_/management/page,_N_T_/management"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/management","dataRoute":"/management.rsc"},"/analysis/student":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/analysis/layout,_N_T_/analysis/student/layout,_N_T_/analysis/student/page,_N_T_/analysis/student"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/analysis/student","dataRoute":"/analysis/student.rsc"},"/analysis/class":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/analysis/layout,_N_T_/analysis/class/layout,_N_T_/analysis/class/page,_N_T_/analysis/class"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/analysis/class","dataRoute":"/analysis/class.rsc"},"/scores/add":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/scores/layout,_N_T_/scores/add/layout,_N_T_/scores/add/page,_N_T_/scores/add"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/scores/add","dataRoute":"/scores/add.rsc"}},"dynamicRoutes":{},"notFoundRoutes":[],"preview":{"previewModeId":"process.env.__NEXT_PREVIEW_MODE_ID","previewModeSigningKey":"process.env.__NEXT_PREVIEW_MODE_SIGNING_KEY","previewModeEncryptionKey":"process.env.__NEXT_PREVIEW_MODE_ENCRYPTION_KEY"}}',(()=>{"use strict";var y={},f={};function a(n){var c=f[n];if(c!==void 0)return c.exports;var _=f[n]={id:n,loaded:!1,exports:{}},h=!0;try{y[n](_,_.exports,a),h=!1}finally{h&&delete f[n]}return _.loaded=!0,_.exports}a.m=y,a.amdO={},(()=>{var n=[];a.O=(c,_,h,k)=>{if(_){k=k||0;for(var u=n.length;u>0&&n[u-1][2]>k;u--)n[u]=n[u-1];n[u]=[_,h,k];return}for(var p=1/0,u=0;u<n.length;u++){for(var[_,h,k]=n[u],g=!0,w=0;w<_.length;w++)p>=k&&Object.keys(a.O).every(M=>a.O[M](_[w]))?_.splice(w--,1):(g=!1,k<p&&(p=k));if(g){n.splice(u--,1);var S=h();S!==void 0&&(c=S)}}return c}})(),a.n=n=>{var c=n&&n.__esModule?()=>n.default:()=>n;return a.d(c,{a:c}),c},(()=>{var n,c=Object.getPrototypeOf?_=>Object.getPrototypeOf(_):_=>_.__proto__;a.t=function(_,h){if(1&h&&(_=this(_)),8&h||typeof _=="object"&&_&&(4&h&&_.__esModule||16&h&&typeof _.then=="function"))return _;var k=Object.create(null);a.r(k);var u={};n=n||[null,c({}),c([]),c(c)];for(var p=2&h&&_;typeof p=="object"&&!~n.indexOf(p);p=c(p))Object.getOwnPropertyNames(p).forEach(g=>u[g]=()=>_[g]);return u.default=()=>_,a.d(k,u),k}})(),a.d=(n,c)=>{for(var _ in c)a.o(c,_)&&!a.o(n,_)&&Object.defineProperty(n,_,{enumerable:!0,get:c[_]})},a.e=()=>Promise.resolve(),a.g=function(){if(typeof l=="object")return l;try{return this||Function("return this")()}catch{if(typeof window=="object")return window}}(),a.o=(n,c)=>Object.prototype.hasOwnProperty.call(n,c),a.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},a.nmd=n=>(n.paths=[],n.children||(n.children=[]),n),(()=>{var n={993:0};a.O.j=h=>n[h]===0;var c=(h,k)=>{var u,p,[g,w,S]=k,I=0;if(g.some(P=>n[P]!==0)){for(u in w)a.o(w,u)&&(a.m[u]=w[u]);if(S)var j=S(a)}for(h&&h(k);I<g.length;I++)p=g[I],a.o(n,p)&&n[p]&&n[p][0](),n[p]=0;return a.O(j)},_=i.webpackChunk_N_E=i.webpackChunk_N_E||[];_.forEach(c.bind(null,0)),_.push=c.bind(null,_.push.bind(_))})()})(),(i.webpackChunk_N_E=i.webpackChunk_N_E||[]).push([[962],{1172:ct,1713:ot,8908:st,2328:rt,3131:at,2034:_t,1616:nt,6443:tt,2501:et,7649:Ze,552:Qe,8789:Je,391:ze,3326:Ye,4303:Ve,7959:We,8610:qe,3059:Xe,5492:Ge,6265:Ke,8690:Be,2403:Ue,8024:He,8997:De,8427:Le,5257:$e,2860:je,5514:Fe,5065:Me,2113:Ce,2738:Pe,5027:Ae,8260:Ie,5767:Se,6617:Oe,5376:be,7398:we,1673:Te,1812:Re,8978:ve,3412:Ee,4123:Ne,74:xe,9307:ge,9859:fe,9814:ye,6765:me,8536:ke,5524:pe,1869:he,1465:le,2262:de,5612:ie,2780:ue,1548:ce,7223:oe,5486:se}]),(i.webpackChunk_N_E=i.webpackChunk_N_E||[]).push([[510],{2067:re,6195:ae,7446:(y,f,a)=>{"use strict";a.r(f),a.d(f,{ComponentMod:()=>U,default:()=>B});var n={};a.r(n),a.d(n,{POST:()=>S,runtime:()=>w});var c={};a.r(c),a.d(c,{originalPathname:()=>M,patchFetch:()=>H,requestAsyncStorage:()=>j,routeModule:()=>I,serverHooks:()=>C,staticGenerationAsyncStorage:()=>P});var _=a(8260),h=a(5514),k=a(2860),u=a(2113),p=a(5492),g=a(1146);let w="edge";async function S(K,D){let b=(0,g.N)(D);try{let{scores:N}=await K.json();if(!N||!Array.isArray(N))return p.xk.json({error:"\u7F3A\u5C11\u6210\u7EE9\u6570\u636E\u6216\u683C\u5F0F\u9519\u8BEF"},{status:400});let E={success:0,failed:0,errors:[]};for(let m=0;m<N.length;m++){let e=N[m];try{let o,s=String(e.studentName||"").trim(),r=String(e.className||"").trim(),v=String(e.examName||"").trim(),d=String(e.subject||"").trim();if(!s||!r||!v||!d||e.score===void 0){E.failed++,E.errors.push(`\u7B2C${m+1}\u884C: \u7F3A\u5C11\u5FC5\u8981\u5B57\u6BB5`);continue}let R=parseFloat(e.score);if(isNaN(R)||R<0||R>100){E.failed++,E.errors.push(`\u7B2C${m+1}\u884C: \u5206\u6570\u5E94\u57280-100\u4E4B\u95F4`);continue}if(d==="\u8BED\u6587"||d==="CHINESE")o="CHINESE";else if(d==="\u6570\u5B66"||d==="MATH")o="MATH";else if(d==="\u82F1\u8BED"||d==="ENGLISH")o="ENGLISH";else{E.failed++,E.errors.push(`\u7B2C${m+1}\u884C: \u65E0\u6548\u7684\u79D1\u76EE "${d}"`);continue}let O=await b.class.findFirst({where:{name:r}});O||(O=await b.class.create({data:{name:r}}));let x=await b.student.findFirst({where:{name:s,classId:O.id}});x||(x=await b.student.create({data:{name:s,classId:O.id}}));let T=await b.exam.findFirst({where:{name:v}});if(!T){let Y=e.examDate?new Date(e.examDate):new Date;T=await b.exam.create({data:{name:v,date:Y}})}let $=await b.score.findFirst({where:{studentId:x.id,examId:T.id,subject:o}});$?await b.score.update({where:{id:$.id},data:{score:R}}):await b.score.create({data:{studentId:x.id,examId:T.id,subject:o,score:R}}),E.success++}catch(o){console.error(`\u5904\u7406\u7B2C${m+1}\u884C\u6570\u636E\u5931\u8D25:`,o),E.failed++,E.errors.push(`\u7B2C${m+1}\u884C: \u5904\u7406\u5931\u8D25 - ${o}`)}}return p.xk.json({message:"\u6279\u91CF\u5BFC\u5165\u5B8C\u6210",results:E})}catch(N){return console.error("\u6279\u91CF\u5BFC\u5165\u5931\u8D25:",N),p.xk.json({error:"\u6279\u91CF\u5BFC\u5165\u5931\u8D25"},{status:500})}finally{D?.env?.DB||await b.$disconnect()}}let I=new h.AppRouteRouteModule({definition:{kind:k.x.APP_ROUTE,page:"/api/scores/import/route",pathname:"/api/scores/import",filename:"route",bundlePath:"app/api/scores/import/route"},resolvedPagePath:"/Users/ryan/demo2/AI/Grade_M2/src/app/api/scores/import/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:j,staticGenerationAsyncStorage:P,serverHooks:C}=I,M="/api/scores/import/route";function H(){return(0,u.XH)({serverHooks:C,staticGenerationAsyncStorage:P})}let U=c,B=_.a.wrap(I)},1146:_e},y=>{var f=n=>y(y.s=n);y.O(0,[962],()=>f(7446));var a=y.O();(l._ENTRIES=typeof l._ENTRIES>"u"?{}:l._ENTRIES)["middleware_app/api/scores/import/route"]=a}]),function(){let y={exports:{},loaded:!1};return function(a,n){var c=Object.create,_=Object.defineProperty,h=Object.getOwnPropertyDescriptor,k=Object.getOwnPropertyNames,u=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty,g=e=>_(e,"__esModule",{value:!0}),w=(e,o)=>{g(e);for(var s in o)_(e,s,{get:o[s],enumerable:!0})},S=(e,o,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let r of k(o))!p.call(e,r)&&r!=="default"&&_(e,r,{get:()=>o[r],enumerable:!(s=h(o,r))||s.enumerable});return e},I=e=>S(g(_(e!=null?c(u(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);w(n,{default:()=>b});var j=I((V(),ee(L))),P="@next/request-context",C=Symbol.for(P),M=Symbol.for("internal.storage");function H(){let e=l;if(!e[C]){let o=new j.AsyncLocalStorage,s={get:()=>o.getStore(),[M]:o};e[C]=s}return e[C]}var U=H();function B(e,o){return U[M].run(e,o)}function K(e){let o={};return e&&e.forEach((s,r)=>{o[r]=s,r.toLowerCase()==="set-cookie"&&(o[r]=D(s))}),o}function D(e){let o=[],s=0,r,v,d,R,O;function x(){for(;s<e.length&&/\s/.test(e.charAt(s));)s+=1;return s<e.length}function T(){return v=e.charAt(s),v!=="="&&v!==";"&&v!==","}for(;s<e.length;){for(r=s,O=!1;x();)if(v=e.charAt(s),v===","){for(d=s,s+=1,x(),R=s;s<e.length&&T();)s+=1;s<e.length&&e.charAt(s)==="="?(O=!0,s=R,o.push(e.substring(r,d)),r=s):s=d+1}else s+=1;(!O||s>=e.length)&&o.push(e.substring(r,e.length))}return o}function b(e){let o=e.staticRoutes.map(r=>({regexp:new RegExp(r.namedRegex),page:r.page})),s=e.dynamicRoutes?.map(r=>({regexp:new RegExp(r.namedRegex),page:r.page}))||[];return async function(r,v){let d=new URL(r.url).pathname,R={};if(e.nextConfig?.basePath&&d.startsWith(e.nextConfig.basePath)&&(d=d.replace(e.nextConfig.basePath,"")||"/"),e.nextConfig?.i18n)for(let x of e.nextConfig.i18n.locales){let T=new RegExp(`^/${x}($|/)`,"i");if(d.match(T)){d=d.replace(T,"/")||"/";break}}for(let x of o)if(x.regexp.exec(d)){R.name=x.page;break}if(!R.name){let x=E(d);for(let T of s||[]){if(x&&!E(T.page))continue;let $=T.regexp.exec(d);if($){R={name:T.page,params:$.groups};break}}}let O=await B({waitUntil:v.waitUntil},()=>l._ENTRIES[`middleware_${e.name}`].default.call({},{request:{url:r.url,method:r.method,headers:K(r.headers),ip:N(r.headers,m.Ip),geo:{city:N(r.headers,m.City,!0),country:N(r.headers,m.Country,!0),latitude:N(r.headers,m.Latitude),longitude:N(r.headers,m.Longitude),region:N(r.headers,m.Region,!0)},nextConfig:e.nextConfig,page:R,body:r.body}}));return O.waitUntil&&v.waitUntil(O.waitUntil),O.response}}function N(e,o,s=!1){let r=e.get(o)||void 0;return s&&r?decodeURIComponent(r):r}function E(e){return e==="/api"||e.startsWith("/api/")}var m;(function(e){e.City="x-vercel-ip-city",e.Country="x-vercel-ip-country",e.Ip="x-real-ip",e.Latitude="x-vercel-ip-latitude",e.Longitude="x-vercel-ip-longitude",e.Region="x-vercel-ip-country-region"})(m||(m={}))}(y,y.exports),y.exports}.call({}).default({name:"app/api/scores/import/route",staticRoutes:[{page:"/",regex:"^/(?:/)?$",routeKeys:{},namedRegex:"^/(?:/)?$"},{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"},{page:"/analysis/class",regex:"^/analysis/class(?:/)?$",routeKeys:{},namedRegex:"^/analysis/class(?:/)?$"},{page:"/analysis/student",regex:"^/analysis/student(?:/)?$",routeKeys:{},namedRegex:"^/analysis/student(?:/)?$"},{page:"/management",regex:"^/management(?:/)?$",routeKeys:{},namedRegex:"^/management(?:/)?$"},{page:"/scores/add",regex:"^/scores/add(?:/)?$",routeKeys:{},namedRegex:"^/scores/add(?:/)?$"},{page:"/scores/import",regex:"^/scores/import(?:/)?$",routeKeys:{},namedRegex:"^/scores/import(?:/)?$"}],dynamicRoutes:[],nextConfig:{basePath:""}})))(A,A,A);export{ft as default};
