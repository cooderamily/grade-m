var W=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var J=Object.prototype.hasOwnProperty;var Q=(i,l)=>()=>(i&&(l=i(i=0)),l);var K=(i,l,M,f)=>{if(l&&typeof l=="object"||typeof l=="function")for(let g of z(l))!J.call(i,g)&&g!==M&&W(i,g,{get:()=>l[g],enumerable:!(f=Y(l,g))||f.enumerable});return i},G=(i,l,M)=>(K(i,l,"default"),M&&K(M,l,"default"));var Z=i=>K(W({},"__esModule",{value:!0}),i);var F={};import*as lt from"async_hooks";var V=Q(()=>{G(F,lt)});import{__getNamedExports as ee}from"../../../../__next-on-pages-dist__/webpack/9802cf9bbc098bad310494fcc153465f.js";import{__getNamedExports as te}from"../../../../__next-on-pages-dist__/manifest/27d10e462fba646daaa29468a0656e12.js";import"../../../../__next-on-pages-dist__/wasm/wasm_848bce377ad47c933e205bdb413ae8af5ac0ccf0.wasm";var I=globalThis.__nextOnPagesRoutesIsolation.getProxyFor("/api/analytics/student"),t=ee(I,I,I),ne=t.__chunk_1146,_e=t.__chunk_6195,ae=t.__chunk_2067,re=t.__chunk_5486,ce=t.__chunk_7223,se=t.__chunk_1548,oe=t.__chunk_2780,ue=t.__chunk_5612,ie=t.__chunk_2262,de=t.__chunk_1465,le=t.__chunk_1869,he=t.__chunk_5524,pe=t.__chunk_8536,ke=t.__chunk_6765,ye=t.__chunk_9814,fe=t.__chunk_9859,ge=t.__chunk_9307,me=t.__chunk_74,xe=t.__chunk_4123,Ne=t.__chunk_3412,Ee=t.__chunk_8978,ve=t.__chunk_1812,Re=t.__chunk_1673,Te=t.__chunk_7398,be=t.__chunk_5376,Ie=t.__chunk_6617,Oe=t.__chunk_5767,we=t.__chunk_8260,Ae=t.__chunk_5027,Se=t.__chunk_2738,Pe=t.__chunk_2113,je=t.__chunk_5065,Me=t.__chunk_5514,Ce=t.__chunk_2860,Fe=t.__chunk_5257,Le=t.__chunk_8427,$e=t.__chunk_8997,Ue=t.__chunk_8024,Be=t.__chunk_2403,De=t.__chunk_8690,He=t.__chunk_6265,Ke=t.__chunk_5492,Ge=t.__chunk_3059,qe=t.__chunk_8610,Xe=t.__chunk_7959,We=t.__chunk_4303,Ve=t.__chunk_3326,Ye=t.__chunk_391,ze=t.__chunk_8789,Je=t.__chunk_552,Qe=t.__chunk_7649,Ze=t.__chunk_2501,et=t.__chunk_6443,tt=t.__chunk_1616,nt=t.__chunk_2034,_t=t.__chunk_3131,at=t.__chunk_2328,rt=t.__chunk_8908,ct=t.__chunk_1713,st=t.__chunk_1172,q=te(I,I,I),ot=q.__NEXT_FONT_MANIFEST,ut=q.__REACT_LOADABLE_MANIFEST,it=q.__BUILD_MANIFEST,ft=((i,l,M)=>(l._ENTRIES={},i.__BUILD_MANIFEST=it,i.__REACT_LOADABLE_MANIFEST=ut,i.__NEXT_FONT_MANIFEST=ot,i.__INTERCEPTION_ROUTE_REWRITE_MANIFEST="[]",i.__PRERENDER_MANIFEST='{"version":4,"routes":{"/":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/page,_N_T_/"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/","dataRoute":"/index.rsc"},"/scores/import":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/scores/layout,_N_T_/scores/import/layout,_N_T_/scores/import/page,_N_T_/scores/import"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/scores/import","dataRoute":"/scores/import.rsc"},"/management":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/management/layout,_N_T_/management/page,_N_T_/management"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/management","dataRoute":"/management.rsc"},"/analysis/student":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/analysis/layout,_N_T_/analysis/student/layout,_N_T_/analysis/student/page,_N_T_/analysis/student"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/analysis/student","dataRoute":"/analysis/student.rsc"},"/analysis/class":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/analysis/layout,_N_T_/analysis/class/layout,_N_T_/analysis/class/page,_N_T_/analysis/class"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/analysis/class","dataRoute":"/analysis/class.rsc"},"/scores/add":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/scores/layout,_N_T_/scores/add/layout,_N_T_/scores/add/page,_N_T_/scores/add"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/scores/add","dataRoute":"/scores/add.rsc"}},"dynamicRoutes":{},"notFoundRoutes":[],"preview":{"previewModeId":"process.env.__NEXT_PREVIEW_MODE_ID","previewModeSigningKey":"process.env.__NEXT_PREVIEW_MODE_SIGNING_KEY","previewModeEncryptionKey":"process.env.__NEXT_PREVIEW_MODE_ENCRYPTION_KEY"}}',(()=>{"use strict";var f={},g={};function a(n){var o=g[n];if(o!==void 0)return o.exports;var _=g[n]={id:n,loaded:!1,exports:{}},h=!0;try{f[n](_,_.exports,a),h=!1}finally{h&&delete g[n]}return _.loaded=!0,_.exports}a.m=f,a.amdO={},(()=>{var n=[];a.O=(o,_,h,y)=>{if(_){y=y||0;for(var u=n.length;u>0&&n[u-1][2]>y;u--)n[u]=n[u-1];n[u]=[_,h,y];return}for(var d=1/0,u=0;u<n.length;u++){for(var[_,h,y]=n[u],m=!0,N=0;N<_.length;N++)d>=y&&Object.keys(a.O).every(P=>a.O[P](_[N]))?_.splice(N--,1):(m=!1,y<d&&(d=y));if(m){n.splice(u--,1);var b=h();b!==void 0&&(o=b)}}return o}})(),a.n=n=>{var o=n&&n.__esModule?()=>n.default:()=>n;return a.d(o,{a:o}),o},(()=>{var n,o=Object.getPrototypeOf?_=>Object.getPrototypeOf(_):_=>_.__proto__;a.t=function(_,h){if(1&h&&(_=this(_)),8&h||typeof _=="object"&&_&&(4&h&&_.__esModule||16&h&&typeof _.then=="function"))return _;var y=Object.create(null);a.r(y);var u={};n=n||[null,o({}),o([]),o(o)];for(var d=2&h&&_;typeof d=="object"&&!~n.indexOf(d);d=o(d))Object.getOwnPropertyNames(d).forEach(m=>u[m]=()=>_[m]);return u.default=()=>_,a.d(y,u),y}})(),a.d=(n,o)=>{for(var _ in o)a.o(o,_)&&!a.o(n,_)&&Object.defineProperty(n,_,{enumerable:!0,get:o[_]})},a.e=()=>Promise.resolve(),a.g=function(){if(typeof l=="object")return l;try{return this||Function("return this")()}catch{if(typeof window=="object")return window}}(),a.o=(n,o)=>Object.prototype.hasOwnProperty.call(n,o),a.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},a.nmd=n=>(n.paths=[],n.children||(n.children=[]),n),(()=>{var n={993:0};a.O.j=h=>n[h]===0;var o=(h,y)=>{var u,d,[m,N,b]=y,A=0;if(m.some(C=>n[C]!==0)){for(u in N)a.o(N,u)&&(a.m[u]=N[u]);if(b)var S=b(a)}for(h&&h(y);A<m.length;A++)d=m[A],a.o(n,d)&&n[d]&&n[d][0](),n[d]=0;return a.O(S)},_=i.webpackChunk_N_E=i.webpackChunk_N_E||[];_.forEach(o.bind(null,0)),_.push=o.bind(null,_.push.bind(_))})()})(),(i.webpackChunk_N_E=i.webpackChunk_N_E||[]).push([[962],{1172:st,1713:ct,8908:rt,2328:at,3131:_t,2034:nt,1616:tt,6443:et,2501:Ze,7649:Qe,552:Je,8789:ze,391:Ye,3326:Ve,4303:We,7959:Xe,8610:qe,3059:Ge,5492:Ke,6265:He,8690:De,2403:Be,8024:Ue,8997:$e,8427:Le,5257:Fe,2860:Ce,5514:Me,5065:je,2113:Pe,2738:Se,5027:Ae,8260:we,5767:Oe,6617:Ie,5376:be,7398:Te,1673:Re,1812:ve,8978:Ee,3412:Ne,4123:xe,74:me,9307:ge,9859:fe,9814:ye,6765:ke,8536:pe,5524:he,1869:le,1465:de,2262:ie,5612:ue,2780:oe,1548:se,7223:ce,5486:re}]),(i.webpackChunk_N_E=i.webpackChunk_N_E||[]).push([[635],{2067:ae,6195:_e,6724:(f,g,a)=>{"use strict";a.r(g),a.d(g,{ComponentMod:()=>D,default:()=>H});var n={};a.r(n),a.d(n,{GET:()=>A,dynamic:()=>b,runtime:()=>N});var o={};a.r(o),a.d(o,{originalPathname:()=>U,patchFetch:()=>B,requestAsyncStorage:()=>C,routeModule:()=>S,serverHooks:()=>P,staticGenerationAsyncStorage:()=>j});var _=a(8260),h=a(5514),y=a(2860),u=a(2113),d=a(5492),m=a(1146);let N="edge",b="force-dynamic";async function A(L,$){let E=(0,m.N)($);try{let O=L.nextUrl.searchParams.get("studentId"),v=L.nextUrl.searchParams.get("subject");if(!O)return d.xk.json({error:"\u7F3A\u5C11\u5B66\u751FID\u53C2\u6570"},{status:400});let e=await E.student.findUnique({where:{id:parseInt(O)},include:{class:!0}});if(!e)return d.xk.json({error:"\u5B66\u751F\u4E0D\u5B58\u5728"},{status:404});let s=await E.score.findMany({where:{studentId:parseInt(O),...v&&{subject:v}},include:{exam:!0},orderBy:{exam:{date:"asc"}}}),c=[];for(let p of s){let k=await E.score.findMany({where:{examId:p.examId,subject:p.subject,student:{classId:e.classId}},orderBy:{score:"desc"}}),x=k.findIndex(R=>R.id===p.id)+1;c.push({examId:p.examId,subject:p.subject,rank:x,totalStudents:k.length})}let r={};for(let p of["CHINESE","MATH","ENGLISH"]){let k=s.filter(x=>x.subject===p);if(k.length>0){let x=k.reduce((R,T)=>R+T.score,0)/k.length;r[p]=Math.round(100*x)/100}}return d.xk.json({student:e,scoreHistory:s,rankings:c,subjectAverages:r,totalExams:s.length>0?Array.from(new Set(s.map(p=>p.examId))).length:0})}catch(O){return console.error("\u83B7\u53D6\u5B66\u751F\u5206\u6790\u6570\u636E\u5931\u8D25:",O),d.xk.json({error:"\u83B7\u53D6\u5B66\u751F\u5206\u6790\u6570\u636E\u5931\u8D25"},{status:500})}finally{$?.env?.DB||await E.$disconnect()}}let S=new h.AppRouteRouteModule({definition:{kind:y.x.APP_ROUTE,page:"/api/analytics/student/route",pathname:"/api/analytics/student",filename:"route",bundlePath:"app/api/analytics/student/route"},resolvedPagePath:"/Users/ryan/demo2/AI/Grade_M2/src/app/api/analytics/student/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:C,staticGenerationAsyncStorage:j,serverHooks:P}=S,U="/api/analytics/student/route";function B(){return(0,u.XH)({serverHooks:P,staticGenerationAsyncStorage:j})}let D=o,H=_.a.wrap(S)},1146:ne},f=>{var g=n=>f(f.s=n);f.O(0,[962],()=>g(6724));var a=f.O();(l._ENTRIES=typeof l._ENTRIES>"u"?{}:l._ENTRIES)["middleware_app/api/analytics/student/route"]=a}]),function(){let f={exports:{},loaded:!1};return function(a,n){var o=Object.create,_=Object.defineProperty,h=Object.getOwnPropertyDescriptor,y=Object.getOwnPropertyNames,u=Object.getPrototypeOf,d=Object.prototype.hasOwnProperty,m=e=>_(e,"__esModule",{value:!0}),N=(e,s)=>{m(e);for(var c in s)_(e,c,{get:s[c],enumerable:!0})},b=(e,s,c)=>{if(s&&typeof s=="object"||typeof s=="function")for(let r of y(s))!d.call(e,r)&&r!=="default"&&_(e,r,{get:()=>s[r],enumerable:!(c=h(s,r))||c.enumerable});return e},A=e=>b(m(_(e!=null?o(u(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);N(n,{default:()=>$});var S=A((V(),Z(F))),C="@next/request-context",j=Symbol.for(C),P=Symbol.for("internal.storage");function U(){let e=l;if(!e[j]){let s=new S.AsyncLocalStorage,c={get:()=>s.getStore(),[P]:s};e[j]=c}return e[j]}var B=U();function D(e,s){return B[P].run(e,s)}function H(e){let s={};return e&&e.forEach((c,r)=>{s[r]=c,r.toLowerCase()==="set-cookie"&&(s[r]=L(c))}),s}function L(e){let s=[],c=0,r,p,k,x,R;function T(){for(;c<e.length&&/\s/.test(e.charAt(c));)c+=1;return c<e.length}function w(){return p=e.charAt(c),p!=="="&&p!==";"&&p!==","}for(;c<e.length;){for(r=c,R=!1;T();)if(p=e.charAt(c),p===","){for(k=c,c+=1,T(),x=c;c<e.length&&w();)c+=1;c<e.length&&e.charAt(c)==="="?(R=!0,c=x,s.push(e.substring(r,k)),r=c):c=k+1}else c+=1;(!R||c>=e.length)&&s.push(e.substring(r,e.length))}return s}function $(e){let s=e.staticRoutes.map(r=>({regexp:new RegExp(r.namedRegex),page:r.page})),c=e.dynamicRoutes?.map(r=>({regexp:new RegExp(r.namedRegex),page:r.page}))||[];return async function(r,p){let k=new URL(r.url).pathname,x={};if(e.nextConfig?.basePath&&k.startsWith(e.nextConfig.basePath)&&(k=k.replace(e.nextConfig.basePath,"")||"/"),e.nextConfig?.i18n)for(let T of e.nextConfig.i18n.locales){let w=new RegExp(`^/${T}($|/)`,"i");if(k.match(w)){k=k.replace(w,"/")||"/";break}}for(let T of s)if(T.regexp.exec(k)){x.name=T.page;break}if(!x.name){let T=O(k);for(let w of c||[]){if(T&&!O(w.page))continue;let X=w.regexp.exec(k);if(X){x={name:w.page,params:X.groups};break}}}let R=await D({waitUntil:p.waitUntil},()=>l._ENTRIES[`middleware_${e.name}`].default.call({},{request:{url:r.url,method:r.method,headers:H(r.headers),ip:E(r.headers,v.Ip),geo:{city:E(r.headers,v.City,!0),country:E(r.headers,v.Country,!0),latitude:E(r.headers,v.Latitude),longitude:E(r.headers,v.Longitude),region:E(r.headers,v.Region,!0)},nextConfig:e.nextConfig,page:x,body:r.body}}));return R.waitUntil&&p.waitUntil(R.waitUntil),R.response}}function E(e,s,c=!1){let r=e.get(s)||void 0;return c&&r?decodeURIComponent(r):r}function O(e){return e==="/api"||e.startsWith("/api/")}var v;(function(e){e.City="x-vercel-ip-city",e.Country="x-vercel-ip-country",e.Ip="x-real-ip",e.Latitude="x-vercel-ip-latitude",e.Longitude="x-vercel-ip-longitude",e.Region="x-vercel-ip-country-region"})(v||(v={}))}(f,f.exports),f.exports}.call({}).default({name:"app/api/analytics/student/route",staticRoutes:[{page:"/",regex:"^/(?:/)?$",routeKeys:{},namedRegex:"^/(?:/)?$"},{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"},{page:"/analysis/class",regex:"^/analysis/class(?:/)?$",routeKeys:{},namedRegex:"^/analysis/class(?:/)?$"},{page:"/analysis/student",regex:"^/analysis/student(?:/)?$",routeKeys:{},namedRegex:"^/analysis/student(?:/)?$"},{page:"/management",regex:"^/management(?:/)?$",routeKeys:{},namedRegex:"^/management(?:/)?$"},{page:"/scores/add",regex:"^/scores/add(?:/)?$",routeKeys:{},namedRegex:"^/scores/add(?:/)?$"},{page:"/scores/import",regex:"^/scores/import(?:/)?$",routeKeys:{},namedRegex:"^/scores/import(?:/)?$"}],dynamicRoutes:[],nextConfig:{basePath:""}})))(I,I,I);export{ft as default};
