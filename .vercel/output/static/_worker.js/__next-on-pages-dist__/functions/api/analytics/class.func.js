var Q=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var _e=Object.prototype.hasOwnProperty;var ae=(i,d)=>()=>(i&&(d=i(i=0)),d);var Y=(i,d,U,g)=>{if(d&&typeof d=="object"||typeof d=="function")for(let m of ne(d))!_e.call(i,m)&&m!==U&&Q(i,m,{get:()=>d[m],enumerable:!(g=te(d,m))||g.enumerable});return i},z=(i,d,U)=>(Y(i,d,"default"),U&&Y(U,d,"default"));var re=i=>Y(Q({},"__esModule",{value:!0}),i);var D={};import*as gt from"async_hooks";var Z=ae(()=>{z(D,gt)});import{__getNamedExports as ce}from"../../../../__next-on-pages-dist__/webpack/9802cf9bbc098bad310494fcc153465f.js";import{__getNamedExports as se}from"../../../../__next-on-pages-dist__/manifest/27d10e462fba646daaa29468a0656e12.js";import"../../../../__next-on-pages-dist__/wasm/wasm_848bce377ad47c933e205bdb413ae8af5ac0ccf0.wasm";var S=globalThis.__nextOnPagesRoutesIsolation.getProxyFor("/api/analytics/class"),t=ce(S,S,S),oe=t.__chunk_1146,ue=t.__chunk_6195,ie=t.__chunk_2067,le=t.__chunk_5486,de=t.__chunk_7223,he=t.__chunk_1548,pe=t.__chunk_2780,ye=t.__chunk_5612,ke=t.__chunk_2262,fe=t.__chunk_1465,ge=t.__chunk_1869,me=t.__chunk_5524,xe=t.__chunk_8536,Ne=t.__chunk_6765,Ee=t.__chunk_9814,ve=t.__chunk_9859,Re=t.__chunk_9307,Te=t.__chunk_74,be=t.__chunk_4123,Oe=t.__chunk_3412,we=t.__chunk_8978,Ie=t.__chunk_1812,Se=t.__chunk_1673,Ae=t.__chunk_7398,Me=t.__chunk_5376,Pe=t.__chunk_6617,je=t.__chunk_5767,Ce=t.__chunk_8260,Fe=t.__chunk_5027,$e=t.__chunk_2738,Le=t.__chunk_2113,Ue=t.__chunk_5065,Be=t.__chunk_5514,De=t.__chunk_2860,He=t.__chunk_5257,Ke=t.__chunk_8427,Ge=t.__chunk_8997,qe=t.__chunk_8024,Xe=t.__chunk_2403,We=t.__chunk_8690,Ve=t.__chunk_6265,Ye=t.__chunk_5492,ze=t.__chunk_3059,Je=t.__chunk_8610,Qe=t.__chunk_7959,Ze=t.__chunk_4303,et=t.__chunk_3326,tt=t.__chunk_391,nt=t.__chunk_8789,_t=t.__chunk_552,at=t.__chunk_7649,rt=t.__chunk_2501,ct=t.__chunk_6443,st=t.__chunk_1616,ot=t.__chunk_2034,ut=t.__chunk_3131,it=t.__chunk_2328,lt=t.__chunk_8908,dt=t.__chunk_1713,ht=t.__chunk_1172,J=se(S,S,S),pt=J.__NEXT_FONT_MANIFEST,yt=J.__REACT_LOADABLE_MANIFEST,kt=J.__BUILD_MANIFEST,vt=((i,d,U)=>(d._ENTRIES={},i.__BUILD_MANIFEST=kt,i.__REACT_LOADABLE_MANIFEST=yt,i.__NEXT_FONT_MANIFEST=pt,i.__INTERCEPTION_ROUTE_REWRITE_MANIFEST="[]",i.__PRERENDER_MANIFEST='{"version":4,"routes":{"/":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/page,_N_T_/"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/","dataRoute":"/index.rsc"},"/scores/import":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/scores/layout,_N_T_/scores/import/layout,_N_T_/scores/import/page,_N_T_/scores/import"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/scores/import","dataRoute":"/scores/import.rsc"},"/management":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/management/layout,_N_T_/management/page,_N_T_/management"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/management","dataRoute":"/management.rsc"},"/analysis/student":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/analysis/layout,_N_T_/analysis/student/layout,_N_T_/analysis/student/page,_N_T_/analysis/student"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/analysis/student","dataRoute":"/analysis/student.rsc"},"/analysis/class":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/analysis/layout,_N_T_/analysis/class/layout,_N_T_/analysis/class/page,_N_T_/analysis/class"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/analysis/class","dataRoute":"/analysis/class.rsc"},"/scores/add":{"initialHeaders":{"x-next-cache-tags":"_N_T_/layout,_N_T_/scores/layout,_N_T_/scores/add/layout,_N_T_/scores/add/page,_N_T_/scores/add"},"experimentalBypassFor":[{"type":"header","key":"Next-Action"},{"type":"header","key":"content-type","value":"multipart/form-data;.*"}],"initialRevalidateSeconds":false,"srcRoute":"/scores/add","dataRoute":"/scores/add.rsc"}},"dynamicRoutes":{},"notFoundRoutes":[],"preview":{"previewModeId":"process.env.__NEXT_PREVIEW_MODE_ID","previewModeSigningKey":"process.env.__NEXT_PREVIEW_MODE_SIGNING_KEY","previewModeEncryptionKey":"process.env.__NEXT_PREVIEW_MODE_ENCRYPTION_KEY"}}',(()=>{"use strict";var g={},m={};function a(n){var o=m[n];if(o!==void 0)return o.exports;var _=m[n]={id:n,loaded:!1,exports:{}},h=!0;try{g[n](_,_.exports,a),h=!1}finally{h&&delete m[n]}return _.loaded=!0,_.exports}a.m=g,a.amdO={},(()=>{var n=[];a.O=(o,_,h,p)=>{if(_){p=p||0;for(var u=n.length;u>0&&n[u-1][2]>p;u--)n[u]=n[u-1];n[u]=[_,h,p];return}for(var l=1/0,u=0;u<n.length;u++){for(var[_,h,p]=n[u],x=!0,E=0;E<_.length;E++)l>=p&&Object.keys(a.O).every(C=>a.O[C](_[E]))?_.splice(E--,1):(x=!1,p<l&&(l=p));if(x){n.splice(u--,1);var O=h();O!==void 0&&(o=O)}}return o}})(),a.n=n=>{var o=n&&n.__esModule?()=>n.default:()=>n;return a.d(o,{a:o}),o},(()=>{var n,o=Object.getPrototypeOf?_=>Object.getPrototypeOf(_):_=>_.__proto__;a.t=function(_,h){if(1&h&&(_=this(_)),8&h||typeof _=="object"&&_&&(4&h&&_.__esModule||16&h&&typeof _.then=="function"))return _;var p=Object.create(null);a.r(p);var u={};n=n||[null,o({}),o([]),o(o)];for(var l=2&h&&_;typeof l=="object"&&!~n.indexOf(l);l=o(l))Object.getOwnPropertyNames(l).forEach(x=>u[x]=()=>_[x]);return u.default=()=>_,a.d(p,u),p}})(),a.d=(n,o)=>{for(var _ in o)a.o(o,_)&&!a.o(n,_)&&Object.defineProperty(n,_,{enumerable:!0,get:o[_]})},a.e=()=>Promise.resolve(),a.g=function(){if(typeof d=="object")return d;try{return this||Function("return this")()}catch{if(typeof window=="object")return window}}(),a.o=(n,o)=>Object.prototype.hasOwnProperty.call(n,o),a.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},a.nmd=n=>(n.paths=[],n.children||(n.children=[]),n),(()=>{var n={993:0};a.O.j=h=>n[h]===0;var o=(h,p)=>{var u,l,[x,E,O]=p,P=0;if(x.some(B=>n[B]!==0)){for(u in E)a.o(E,u)&&(a.m[u]=E[u]);if(O)var j=O(a)}for(h&&h(p);P<x.length;P++)l=x[P],a.o(n,l)&&n[l]&&n[l][0](),n[l]=0;return a.O(j)},_=i.webpackChunk_N_E=i.webpackChunk_N_E||[];_.forEach(o.bind(null,0)),_.push=o.bind(null,_.push.bind(_))})()})(),(i.webpackChunk_N_E=i.webpackChunk_N_E||[]).push([[962],{1172:ht,1713:dt,8908:lt,2328:it,3131:ut,2034:ot,1616:st,6443:ct,2501:rt,7649:at,552:_t,8789:nt,391:tt,3326:et,4303:Ze,7959:Qe,8610:Je,3059:ze,5492:Ye,6265:Ve,8690:We,2403:Xe,8024:qe,8997:Ge,8427:Ke,5257:He,2860:De,5514:Be,5065:Ue,2113:Le,2738:$e,5027:Fe,8260:Ce,5767:je,6617:Pe,5376:Me,7398:Ae,1673:Se,1812:Ie,8978:we,3412:Oe,4123:be,74:Te,9307:Re,9859:ve,9814:Ee,6765:Ne,8536:xe,5524:me,1869:ge,1465:fe,2262:ke,5612:ye,2780:pe,1548:he,7223:de,5486:le}]),(i.webpackChunk_N_E=i.webpackChunk_N_E||[]).push([[236],{2067:ie,6195:ue,5202:(g,m,a)=>{"use strict";a.r(m),a.d(m,{ComponentMod:()=>X,default:()=>W});var n={};a.r(n),a.d(n,{GET:()=>P,dynamic:()=>O,runtime:()=>E});var o={};a.r(o),a.d(o,{originalPathname:()=>G,patchFetch:()=>q,requestAsyncStorage:()=>B,routeModule:()=>j,serverHooks:()=>C,staticGenerationAsyncStorage:()=>F});var _=a(8260),h=a(5514),p=a(2860),u=a(2113),l=a(5492),x=a(1146);let E="edge",O="force-dynamic";async function P(H,K){let R=(0,x.N)(K);try{let A=H.nextUrl.searchParams.get("classId"),T=H.nextUrl.searchParams.get("subject");if(!A)return l.xk.json({error:"\u7F3A\u5C11\u73ED\u7EA7ID\u53C2\u6570"},{status:400});let e=await R.class.findUnique({where:{id:parseInt(A)},include:{students:!0}});if(!e)return l.xk.json({error:"\u73ED\u7EA7\u4E0D\u5B58\u5728"},{status:404});let s=await R.score.findMany({where:{student:{classId:parseInt(A)},...T&&{subject:T}},include:{student:!0,exam:!0},orderBy:{exam:{date:"desc"}}}),r={},c={},v=new Set;for(let y of s){let k=`${y.examId}-${y.subject}`;v.add(k)}for(let y of Array.from(v)){let[k,N]=y.split("-"),$=s.filter(L=>L.examId===parseInt(k)&&L.subject===N);if($.length>0){let L=$.reduce((M,ee)=>M+ee.score,0)/$.length;r[k]||(r[k]={}),r[k][N]=Math.round(100*L)/100;let V=`${k}-${N}`,b=[0,0,0,0,0];for(let M of $)M.score<60?b[0]++:M.score<70?b[1]++:M.score<80?b[2]++:M.score<90?b[3]++:b[4]++;c[V]=b}}let f={};for(let y of["CHINESE","MATH","ENGLISH"]){let k=s.filter(N=>N.subject===y);if(k.length>0){let N=k.map(b=>b.score),$=N.reduce((b,M)=>b+M,0)/N.length,L=Math.max(...N),V=Math.min(...N);f[y]={average:Math.round(100*$)/100,highest:L,lowest:V,count:N.length}}}let w=Array.from(new Set(s.map(y=>y.examId))),I=await R.exam.findMany({where:{id:{in:w}},orderBy:{date:"desc"}});return l.xk.json({classInfo:e,examSubjectAverages:r,scoreDistribution:c,subjectStats:f,exams:I,totalStudents:e.students.length,totalScores:s.length})}catch(A){return console.error("\u83B7\u53D6\u73ED\u7EA7\u5206\u6790\u6570\u636E\u5931\u8D25:",A),l.xk.json({error:"\u83B7\u53D6\u73ED\u7EA7\u5206\u6790\u6570\u636E\u5931\u8D25"},{status:500})}finally{K?.env?.DB||await R.$disconnect()}}let j=new h.AppRouteRouteModule({definition:{kind:p.x.APP_ROUTE,page:"/api/analytics/class/route",pathname:"/api/analytics/class",filename:"route",bundlePath:"app/api/analytics/class/route"},resolvedPagePath:"/Users/ryan/demo2/AI/Grade_M2/src/app/api/analytics/class/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:B,staticGenerationAsyncStorage:F,serverHooks:C}=j,G="/api/analytics/class/route";function q(){return(0,u.XH)({serverHooks:C,staticGenerationAsyncStorage:F})}let X=o,W=_.a.wrap(j)},1146:oe},g=>{var m=n=>g(g.s=n);g.O(0,[962],()=>m(5202));var a=g.O();(d._ENTRIES=typeof d._ENTRIES>"u"?{}:d._ENTRIES)["middleware_app/api/analytics/class/route"]=a}]),function(){let g={exports:{},loaded:!1};return function(a,n){var o=Object.create,_=Object.defineProperty,h=Object.getOwnPropertyDescriptor,p=Object.getOwnPropertyNames,u=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,x=e=>_(e,"__esModule",{value:!0}),E=(e,s)=>{x(e);for(var r in s)_(e,r,{get:s[r],enumerable:!0})},O=(e,s,r)=>{if(s&&typeof s=="object"||typeof s=="function")for(let c of p(s))!l.call(e,c)&&c!=="default"&&_(e,c,{get:()=>s[c],enumerable:!(r=h(s,c))||r.enumerable});return e},P=e=>O(x(_(e!=null?o(u(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);E(n,{default:()=>K});var j=P((Z(),re(D))),B="@next/request-context",F=Symbol.for(B),C=Symbol.for("internal.storage");function G(){let e=d;if(!e[F]){let s=new j.AsyncLocalStorage,r={get:()=>s.getStore(),[C]:s};e[F]=r}return e[F]}var q=G();function X(e,s){return q[C].run(e,s)}function W(e){let s={};return e&&e.forEach((r,c)=>{s[c]=r,c.toLowerCase()==="set-cookie"&&(s[c]=H(r))}),s}function H(e){let s=[],r=0,c,v,f,w,I;function y(){for(;r<e.length&&/\s/.test(e.charAt(r));)r+=1;return r<e.length}function k(){return v=e.charAt(r),v!=="="&&v!==";"&&v!==","}for(;r<e.length;){for(c=r,I=!1;y();)if(v=e.charAt(r),v===","){for(f=r,r+=1,y(),w=r;r<e.length&&k();)r+=1;r<e.length&&e.charAt(r)==="="?(I=!0,r=w,s.push(e.substring(c,f)),c=r):r=f+1}else r+=1;(!I||r>=e.length)&&s.push(e.substring(c,e.length))}return s}function K(e){let s=e.staticRoutes.map(c=>({regexp:new RegExp(c.namedRegex),page:c.page})),r=e.dynamicRoutes?.map(c=>({regexp:new RegExp(c.namedRegex),page:c.page}))||[];return async function(c,v){let f=new URL(c.url).pathname,w={};if(e.nextConfig?.basePath&&f.startsWith(e.nextConfig.basePath)&&(f=f.replace(e.nextConfig.basePath,"")||"/"),e.nextConfig?.i18n)for(let y of e.nextConfig.i18n.locales){let k=new RegExp(`^/${y}($|/)`,"i");if(f.match(k)){f=f.replace(k,"/")||"/";break}}for(let y of s)if(y.regexp.exec(f)){w.name=y.page;break}if(!w.name){let y=A(f);for(let k of r||[]){if(y&&!A(k.page))continue;let N=k.regexp.exec(f);if(N){w={name:k.page,params:N.groups};break}}}let I=await X({waitUntil:v.waitUntil},()=>d._ENTRIES[`middleware_${e.name}`].default.call({},{request:{url:c.url,method:c.method,headers:W(c.headers),ip:R(c.headers,T.Ip),geo:{city:R(c.headers,T.City,!0),country:R(c.headers,T.Country,!0),latitude:R(c.headers,T.Latitude),longitude:R(c.headers,T.Longitude),region:R(c.headers,T.Region,!0)},nextConfig:e.nextConfig,page:w,body:c.body}}));return I.waitUntil&&v.waitUntil(I.waitUntil),I.response}}function R(e,s,r=!1){let c=e.get(s)||void 0;return r&&c?decodeURIComponent(c):c}function A(e){return e==="/api"||e.startsWith("/api/")}var T;(function(e){e.City="x-vercel-ip-city",e.Country="x-vercel-ip-country",e.Ip="x-real-ip",e.Latitude="x-vercel-ip-latitude",e.Longitude="x-vercel-ip-longitude",e.Region="x-vercel-ip-country-region"})(T||(T={}))}(g,g.exports),g.exports}.call({}).default({name:"app/api/analytics/class/route",staticRoutes:[{page:"/",regex:"^/(?:/)?$",routeKeys:{},namedRegex:"^/(?:/)?$"},{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"},{page:"/analysis/class",regex:"^/analysis/class(?:/)?$",routeKeys:{},namedRegex:"^/analysis/class(?:/)?$"},{page:"/analysis/student",regex:"^/analysis/student(?:/)?$",routeKeys:{},namedRegex:"^/analysis/student(?:/)?$"},{page:"/management",regex:"^/management(?:/)?$",routeKeys:{},namedRegex:"^/management(?:/)?$"},{page:"/scores/add",regex:"^/scores/add(?:/)?$",routeKeys:{},namedRegex:"^/scores/add(?:/)?$"},{page:"/scores/import",regex:"^/scores/import(?:/)?$",routeKeys:{},namedRegex:"^/scores/import(?:/)?$"}],dynamicRoutes:[],nextConfig:{basePath:""}})))(S,S,S);export{vt as default};
