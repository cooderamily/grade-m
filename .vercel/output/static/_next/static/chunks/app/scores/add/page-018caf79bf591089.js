(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[938],{42227:function(e,t,s){Promise.resolve().then(s.bind(s,8903))},8903:function(e,t,s){"use strict";s.d(t,{default:function(){return y}});var l=s(57437),a=s(2265),r=s(92566),i=s(54142),n=s(2842),c=s(9542),d=s(16638),o=s(78703),x=s(61876),h=s(89733),m=s(77209),u=s(41646),j=s(2128),f=s(48185),g=s(86763);let v=[{value:"CHINESE",label:"语文"},{value:"MATH",label:"数学"},{value:"ENGLISH",label:"英语"}],p={CHINESE:"语文",MATH:"数学",ENGLISH:"英语"},b={score:{label:"分数",color:"hsl(var(--chart-1))"},rank:{label:"排名",color:"hsl(var(--chart-1))"}};function y(){var e,t,s,y,N,k,w,S,D,I,L,E,H,M,T;let{toast:F}=(0,g.pm)(),[C,_]=(0,a.useState)([]),[O,A]=(0,a.useState)([]),[B,K]=(0,a.useState)([]),[P,Y]=(0,a.useState)(!1),[Z,V]=(0,a.useState)(!1),[W,G]=(0,a.useState)(null),[Q,z]=(0,a.useState)(!1),[R,q]=(0,a.useState)(""),[J,U]=(0,a.useState)(""),[X,$]=(0,a.useState)(""),[ee,et]=(0,a.useState)(""),[es,el]=(0,a.useState)(""),[ea,er]=(0,a.useState)("");(0,a.useEffect)(()=>{ei()},[]),(0,a.useEffect)(()=>{J?en(parseInt(J)):(A([]),$(""))},[J]);let ei=async()=>{Y(!0);try{let[e,t]=await Promise.all([fetch("/api/classes"),fetch("/api/exams")]);if(e.ok){let t=await e.json();_(t)}if(t.ok){let e=await t.json();K(e)}}catch(e){console.error("加载基础数据失败:",e)}finally{Y(!1)}},en=async e=>{try{let t=await fetch("/api/students?classId=".concat(e));if(t.ok){let e=await t.json();A(e)}}catch(e){console.error("加载学生数据失败:",e)}},ec=async e=>{z(!0);try{let t=await fetch("/api/analytics/student?studentId=".concat(e));if(t.ok){let e=await t.json();G(e)}else console.error("加载分析数据失败"),G(null)}catch(e){console.error("加载分析数据失败:",e),G(null)}finally{z(!1)}},ed=async e=>{if(e.preventDefault(),!X||!ee||!es||!ea){F({title:"信息不完整",description:"请填写完整信息",variant:"destructive"});return}if(0>parseFloat(ea)||parseFloat(ea)>100){F({title:"分数无效",description:"成绩应在0-100之间",variant:"destructive"});return}V(!0);try{let e=await fetch("/api/scores",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({studentId:parseInt(X),examId:parseInt(ee),subject:es,score:parseFloat(ea)})});if(e.ok)F({title:"录入成功！",description:"成绩已成功录入系统"}),q(es),er(""),await ec(X);else{let t=await e.json();F({title:"录入失败",description:t.error||"未知错误",variant:"destructive"})}}catch(e){console.error("提交失败:",e),F({title:"网络错误",description:"网络连接失败，请重试",variant:"destructive"})}finally{V(!1)}};(()=>{if(!W)return;let e=new Map;for(let t of W.scoreHistory){let s=t.examId;e.has(s)||e.set(s,{examName:t.exam.name,examDate:t.exam.date,CHINESE:null,MATH:null,ENGLISH:null}),e.get(s)[t.subject]=t.score}return Array.from(e.values()).sort((e,t)=>new Date(e.examDate).getTime()-new Date(t.examDate).getTime())})(),(()=>{if(!W)return;let e=new Map;for(let t of W.rankings){let s=W.scoreHistory.find(e=>e.examId===t.examId&&e.subject===t.subject);if(s){let l=s.examId;e.has(l)||e.set(l,{examName:s.exam.name,examDate:s.exam.date,CHINESE:null,MATH:null,ENGLISH:null}),e.get(l)[t.subject]=t.rank}}return Array.from(e.values()).sort((e,t)=>new Date(e.examDate).getTime()-new Date(t.examDate).getTime())})();let eo=(()=>{if(!W||!R)return[];let e=new Map;for(let t of W.scoreHistory)if(t.subject===R){let s=t.examId;e.has(s)||e.set(s,{examName:t.exam.name,examDate:t.exam.date,score:Number(t.score)})}let t=Array.from(e.values()).sort((e,t)=>new Date(e.examDate).getTime()-new Date(t.examDate).getTime());return console.log("单科目图表数据:",R,t),t})(),ex=(()=>{if(!W||!R)return[];let e=new Map;for(let t of W.rankings)if(t.subject===R){let s=W.scoreHistory.find(e=>e.examId===t.examId&&e.subject===t.subject);if(s){let l=s.examId;e.has(l)||e.set(l,{examName:s.exam.name,examDate:s.exam.date,rank:Number(t.rank)})}}let t=Array.from(e.values()).sort((e,t)=>new Date(e.examDate).getTime()-new Date(t.examDate).getTime());return console.log("单科目排名数据:",R,t),t})();return P?(0,l.jsx)(f.Zb,{children:(0,l.jsx)(f.aY,{className:"p-6",children:(0,l.jsx)("div",{className:"text-center",children:"加载中..."})})}):(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,l.jsxs)(f.Zb,{children:[(0,l.jsx)(f.Ol,{children:(0,l.jsx)(f.ll,{children:"成绩录入"})}),(0,l.jsx)(f.aY,{className:"space-y-4",children:(0,l.jsxs)("form",{onSubmit:ed,className:"space-y-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(u._,{htmlFor:"class-select",children:"班级"}),(0,l.jsxs)(j.Ph,{value:J,onValueChange:e=>{U(e),q(""),G(null)},children:[(0,l.jsx)(j.i4,{id:"class-select",children:(0,l.jsx)(j.ki,{placeholder:"选择班级"})}),(0,l.jsx)(j.Bw,{children:C.map(e=>(0,l.jsx)(j.Ql,{value:e.id.toString(),children:e.name},e.id))})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(u._,{htmlFor:"student-select",children:"学生"}),(0,l.jsxs)(j.Ph,{value:X,onValueChange:e=>{$(e),q(""),G(null)},disabled:!J,children:[(0,l.jsx)(j.i4,{id:"student-select",children:(0,l.jsx)(j.ki,{placeholder:J?"选择学生":"请先选择班级"})}),(0,l.jsx)(j.Bw,{children:O.map(e=>(0,l.jsx)(j.Ql,{value:e.id.toString(),children:e.name},e.id))})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(u._,{htmlFor:"exam-select",children:"考试"}),(0,l.jsxs)(j.Ph,{value:ee,onValueChange:et,children:[(0,l.jsx)(j.i4,{id:"exam-select",children:(0,l.jsx)(j.ki,{placeholder:"选择考试"})}),(0,l.jsx)(j.Bw,{children:B.map(e=>(0,l.jsxs)(j.Ql,{value:e.id.toString(),children:[e.name," (",new Date(e.date).toLocaleDateString(),")"]},e.id))})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(u._,{htmlFor:"subject-select",children:"科目"}),(0,l.jsxs)(j.Ph,{value:es,onValueChange:el,children:[(0,l.jsx)(j.i4,{id:"subject-select",children:(0,l.jsx)(j.ki,{placeholder:"选择科目"})}),(0,l.jsx)(j.Bw,{children:v.map(e=>(0,l.jsx)(j.Ql,{value:e.value,children:e.label},e.value))})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(u._,{htmlFor:"score-input",children:"分数"}),(0,l.jsx)(m.I,{id:"score-input",type:"number",min:"0",max:"100",step:"0.5",placeholder:"请输入分数",value:ea,onChange:e=>er(e.target.value)})]}),(0,l.jsx)(h.z,{type:"submit",className:"w-full",disabled:Z||!X||!ee||!es||!ea,children:Z?"录入中...":"录入成绩"})]})})]}),(0,l.jsxs)("div",{className:"space-y-6",children:[Q&&(0,l.jsx)(f.Zb,{children:(0,l.jsx)(f.aY,{className:"p-6",children:(0,l.jsx)("div",{className:"text-center",children:"加载分析数据中..."})})}),W&&R&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(f.Zb,{children:[(0,l.jsx)(f.Ol,{children:(0,l.jsx)(f.ll,{children:"学生信息"})}),(0,l.jsx)(f.aY,{children:(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"姓名"}),(0,l.jsx)("p",{className:"font-semibold",children:W.student.name})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"班级"}),(0,l.jsx)("p",{className:"font-semibold",children:null===(e=W.student.class)||void 0===e?void 0:e.name})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"科目"}),(0,l.jsx)("p",{className:"font-semibold",children:p[R]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"成绩记录"}),(0,l.jsxs)("p",{className:"font-semibold",children:[W.scoreHistory.filter(e=>e.subject===R).length," 条"]})]})]})})]}),eo.length>1&&(0,l.jsxs)(f.Zb,{children:[(0,l.jsx)(f.Ol,{children:(0,l.jsx)(f.ll,{children:"进度分析"})}),(0,l.jsx)(f.aY,{children:(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"最新分数"}),(0,l.jsxs)("p",{className:"font-semibold text-2xl",children:[null===(t=eo[eo.length-1])||void 0===t?void 0:t.score," 分"]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"分数变化"}),(0,l.jsxs)("p",{className:"font-semibold text-2xl ".concat(eo.length>1?(null===(s=eo[eo.length-1])||void 0===s?void 0:s.score)-(null===(y=eo[eo.length-2])||void 0===y?void 0:y.score)>0?"text-green-600":"text-red-600":"text-gray-600"),children:[eo.length>1&&(null===(N=eo[eo.length-1])||void 0===N?void 0:N.score)-(null===(k=eo[eo.length-2])||void 0===k?void 0:k.score)>0?"+":"",eo.length>1?((null===(w=eo[eo.length-1])||void 0===w?void 0:w.score)-(null===(S=eo[eo.length-2])||void 0===S?void 0:S.score)).toFixed(1):"0.0"," 分"]})]}),ex.length>0&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"当前排名"}),(0,l.jsxs)("p",{className:"font-semibold text-2xl",children:["第 ",null===(D=ex[ex.length-1])||void 0===D?void 0:D.rank," 名"]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"排名变化"}),(0,l.jsxs)("p",{className:"font-semibold text-2xl ".concat(ex.length>1?(null===(I=ex[ex.length-2])||void 0===I?void 0:I.rank)-(null===(L=ex[ex.length-1])||void 0===L?void 0:L.rank)>0?"text-green-600":"text-red-600":"text-gray-600"),children:[ex.length>1?(null===(E=ex[ex.length-2])||void 0===E?void 0:E.rank)-(null===(H=ex[ex.length-1])||void 0===H?void 0:H.rank)>0?"↑":"↓":"-",ex.length>1?Math.abs((null===(M=ex[ex.length-2])||void 0===M?void 0:M.rank)-(null===(T=ex[ex.length-1])||void 0===T?void 0:T.rank)):0," 名"]})]})]})]})})]}),(0,l.jsxs)("div",{className:"space-y-6",children:[eo.length>0&&(0,l.jsxs)(f.Zb,{children:[(0,l.jsx)(f.Ol,{children:(0,l.jsx)(f.ll,{children:"分数变化"})}),(0,l.jsx)(f.aY,{children:(0,l.jsx)(x.BO,{config:b,className:"w-full ",children:(0,l.jsxs)(r.w,{accessibilityLayer:!0,data:eo,margin:{left:12,right:12},children:[(0,l.jsx)(i.q,{vertical:!1}),(0,l.jsx)(n.K,{dataKey:"examName",tickLine:!1,axisLine:!1,tickMargin:8,tickFormatter:e=>e.slice(0,3)}),(0,l.jsx)(c.B,{domain:[0,100],tickLine:!1,axisLine:!1,tickMargin:8}),(0,l.jsx)(x.h7,{cursor:!1,content:(0,l.jsx)(x.dg,{hideLabel:!0})}),(0,l.jsx)(d.x,{dataKey:"score",type:"natural",stroke:b.score.color,strokeWidth:2,dot:{fill:b.score.color,r:4},activeDot:{r:6,fill:b.score.color,stroke:b.score.color},children:(0,l.jsx)(o.e,{dataKey:"score",position:"top",style:{fontSize:"12px",fill:b.score.color,fontWeight:"bold"}})})]})})})]}),ex.length>0&&(0,l.jsxs)(f.Zb,{children:[(0,l.jsx)(f.Ol,{children:(0,l.jsx)(f.ll,{children:"排名变化"})}),(0,l.jsx)(f.aY,{children:(0,l.jsx)(x.BO,{config:b,className:"w-full",children:(0,l.jsxs)(r.w,{accessibilityLayer:!0,data:ex,margin:{left:12,right:12},children:[(0,l.jsx)(i.q,{vertical:!1}),(0,l.jsx)(n.K,{dataKey:"examName",tickLine:!1,axisLine:!1,tickMargin:8,tickFormatter:e=>e.slice(0,3)}),(0,l.jsx)(c.B,{reversed:!0,domain:[1,"dataMax"],tickLine:!1,axisLine:!1,tickMargin:8}),(0,l.jsx)(x.h7,{cursor:!1,content:(0,l.jsx)(x.dg,{hideLabel:!0})}),(0,l.jsx)(d.x,{dataKey:"rank",type:"natural",stroke:b.rank.color,strokeWidth:2,dot:{fill:b.rank.color,r:4},activeDot:{r:6,fill:b.rank.color,stroke:b.rank.color},children:(0,l.jsx)(o.e,{dataKey:"rank",position:"bottom",style:{fontSize:"12px",fill:b.rank.color,fontWeight:"bold"}})})]})})})]})]})]}),!W&&!Q&&(0,l.jsx)(f.Zb,{children:(0,l.jsx)(f.aY,{className:"p-6",children:(0,l.jsx)("div",{className:"text-center text-gray-500",children:"录入成绩后将显示该科目的成绩分析"})})})]})]})}},77209:function(e,t,s){"use strict";s.d(t,{I:function(){return i}});var l=s(57437),a=s(2265),r=s(49354);let i=a.forwardRef((e,t)=>{let{className:s,type:a,...i}=e;return(0,l.jsx)("input",{type:a,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...i})});i.displayName="Input"},41646:function(e,t,s){"use strict";s.d(t,{_:function(){return o}});var l=s(57437),a=s(2265),r=s(25171),i=a.forwardRef((e,t)=>(0,l.jsx)(r.WV.label,{...e,ref:t,onMouseDown:t=>{var s;t.target.closest("button, input, select, textarea")||(null===(s=e.onMouseDown)||void 0===s||s.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var n=s(13027),c=s(49354);let d=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)(i,{ref:t,className:(0,c.cn)(d(),s),...a})});o.displayName=i.displayName}},function(e){e.O(0,[314,402,115,989,960,971,23,744],function(){return e(e.s=42227)}),_N_E=e.O()}]);