(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[101],{2032:function(e,s,t){Promise.resolve().then(t.bind(t,61709))},87138:function(e,s,t){"use strict";t.d(s,{default:function(){return l.a}});var a=t(231),l=t.n(a)},61709:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return v}});var a=t(57437),l=t(2265),r=t(92566),i=t(54142),n=t(2842),c=t(9542),o=t(16638),d=t(61876),x=t(48185),m=t(2128),h=t(89733),j=t(86763),u=t(87138);let f={CHINESE:"语文",MATH:"数学",ENGLISH:"英语"},N={CHINESE:{label:"语文",color:"hsl(var(--chart-1))"},MATH:{label:"数学",color:"hsl(var(--chart-2))"},ENGLISH:{label:"英语",color:"hsl(var(--chart-3))"}};function v(){let{toast:e}=(0,j.pm)(),[s,t]=(0,l.useState)([]),[v,g]=(0,l.useState)(""),[p,y]=(0,l.useState)(null),[b,E]=(0,l.useState)(!1);(0,l.useEffect)(()=>{k()},[]);let k=async()=>{try{let e=await fetch("/api/students");if(e.ok){let s=await e.json();t(s)}}catch(e){console.error("加载学生列表失败:",e)}},H=async s=>{E(!0);try{let t=await fetch("/api/analytics/student?studentId=".concat(s));if(t.ok){let e=await t.json();y(e)}else e({title:"加载失败",description:"加载分析数据失败",variant:"destructive"})}catch(s){console.error("加载分析数据失败:",s),e({title:"网络错误",description:"网络连接失败，请重试",variant:"destructive"})}finally{E(!1)}},S=(()=>{if(!p)return[];let e=new Map;for(let s of p.scoreHistory){let t=s.examId;e.has(t)||e.set(t,{examName:s.exam.name,examDate:s.exam.date,CHINESE:null,MATH:null,ENGLISH:null}),e.get(t)[s.subject]=s.score}return Array.from(e.values()).sort((e,s)=>new Date(e.examDate).getTime()-new Date(s.examDate).getTime())})(),I=(()=>{if(!p)return[];let e=new Map;for(let s of p.rankings){let t=p.scoreHistory.find(e=>e.examId===s.examId&&e.subject===s.subject);if(t){let a=t.examId;e.has(a)||e.set(a,{examName:t.exam.name,examDate:t.exam.date,CHINESE:null,MATH:null,ENGLISH:null}),e.get(a)[s.subject]=s.rank}}return Array.from(e.values()).sort((e,s)=>new Date(e.examDate).getTime()-new Date(s.examDate).getTime())})();return(0,a.jsxs)("div",{className:"container mx-auto p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"学生成绩分析"}),(0,a.jsx)(u.default,{href:"/",children:(0,a.jsx)(h.z,{variant:"outline",children:"返回首页"})})]}),(0,a.jsx)("div",{className:"w-full max-w-md",children:(0,a.jsxs)(m.Ph,{value:v,onValueChange:e=>{g(e),e?H(e):y(null)},children:[(0,a.jsx)(m.i4,{children:(0,a.jsx)(m.ki,{placeholder:"选择学生"})}),(0,a.jsx)(m.Bw,{children:s.map(e=>(0,a.jsxs)(m.Ql,{value:e.id.toString(),children:[e.name," - ",e.class.name]},e.id))})]})})]}),b&&(0,a.jsx)(x.Zb,{children:(0,a.jsx)(x.aY,{className:"p-6",children:(0,a.jsx)("div",{className:"text-center",children:"加载分析数据中..."})})}),p&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(x.Zb,{children:[(0,a.jsx)(x.Ol,{children:(0,a.jsx)(x.ll,{children:"学生信息"})}),(0,a.jsx)(x.aY,{children:(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"姓名"}),(0,a.jsx)("p",{className:"font-semibold",children:p.student.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"班级"}),(0,a.jsx)("p",{className:"font-semibold",children:p.student.class.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"参与考试"}),(0,a.jsxs)("p",{className:"font-semibold",children:[p.totalExams," 次"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"成绩记录"}),(0,a.jsxs)("p",{className:"font-semibold",children:[p.scoreHistory.length," 条"]})]})]})})]}),(0,a.jsxs)(x.Zb,{children:[(0,a.jsx)(x.Ol,{children:(0,a.jsx)(x.ll,{children:"科目平均分"})}),(0,a.jsx)(x.aY,{children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(p.subjectAverages).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:f[s]}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:t})]},s)})})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)(x.Zb,{children:[(0,a.jsx)(x.Ol,{children:(0,a.jsx)(x.ll,{children:"成绩趋势"})}),(0,a.jsx)(x.aY,{children:(0,a.jsx)(d.BO,{config:N,className:"h-[300px]",children:(0,a.jsxs)(r.w,{accessibilityLayer:!0,data:S,margin:{left:12,right:12},children:[(0,a.jsx)(i.q,{vertical:!1}),(0,a.jsx)(n.K,{dataKey:"examName",tickLine:!1,axisLine:!1,tickMargin:8,tickFormatter:e=>e.slice(0,3)}),(0,a.jsx)(c.B,{domain:[0,100],tickLine:!1,axisLine:!1,tickMargin:8}),(0,a.jsx)(d.h7,{cursor:!1,content:(0,a.jsx)(d.dg,{})}),(0,a.jsx)(o.x,{dataKey:"CHINESE",type:"monotone",stroke:"var(--color-CHINESE)",strokeWidth:2,dot:!1,label:{fontSize:12,fill:"var(--color-CHINESE)"}}),(0,a.jsx)(o.x,{dataKey:"MATH",type:"monotone",stroke:"var(--color-MATH)",strokeWidth:2,dot:!1,label:{fontSize:12,fill:"var(--color-MATH)"}}),(0,a.jsx)(o.x,{dataKey:"ENGLISH",type:"monotone",stroke:"var(--color-ENGLISH)",strokeWidth:2,dot:!1,label:{fontSize:12,fill:"var(--color-ENGLISH)"}}),(0,a.jsx)(d.Qk,{content:(0,a.jsx)(d.cD,{})})]})})})]}),(0,a.jsxs)(x.Zb,{children:[(0,a.jsx)(x.Ol,{children:(0,a.jsx)(x.ll,{children:"班级排名变化"})}),(0,a.jsx)(x.aY,{children:(0,a.jsx)(d.BO,{config:N,className:"h-[300px]",children:(0,a.jsxs)(r.w,{accessibilityLayer:!0,data:I,margin:{left:12,right:12},children:[(0,a.jsx)(i.q,{vertical:!1}),(0,a.jsx)(n.K,{dataKey:"examName",tickLine:!1,axisLine:!1,tickMargin:8,tickFormatter:e=>e.slice(0,3)}),(0,a.jsx)(c.B,{reversed:!0,domain:[1,"dataMax"],tickLine:!1,axisLine:!1,tickMargin:8}),(0,a.jsx)(d.h7,{cursor:!1,content:(0,a.jsx)(d.dg,{})}),(0,a.jsx)(o.x,{dataKey:"CHINESE",type:"monotone",stroke:"var(--color-CHINESE)",strokeWidth:2,dot:!1,label:{fontSize:12,fill:"var(--color-CHINESE)"}}),(0,a.jsx)(o.x,{dataKey:"MATH",type:"monotone",stroke:"var(--color-MATH)",strokeWidth:2,dot:!1,label:{fontSize:12,fill:"var(--color-MATH)"}}),(0,a.jsx)(o.x,{dataKey:"ENGLISH",type:"monotone",stroke:"var(--color-ENGLISH)",strokeWidth:2,dot:!1,label:{fontSize:12,fill:"var(--color-ENGLISH)"}}),(0,a.jsx)(d.Qk,{content:(0,a.jsx)(d.cD,{})})]})})})]})]})]}),!v&&!b&&(0,a.jsx)(x.Zb,{children:(0,a.jsx)(x.aY,{className:"p-6",children:(0,a.jsx)("div",{className:"text-center text-gray-500",children:"请选择一个学生查看详细的成绩分析"})})})]})}}},function(e){e.O(0,[314,402,115,231,989,960,971,23,744],function(){return e(e.s=2032)}),_N_E=e.O()}]);