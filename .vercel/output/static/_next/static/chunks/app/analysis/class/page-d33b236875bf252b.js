(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[235],{67756:function(e,s,a){Promise.resolve().then(a.bind(a,16950))},87138:function(e,s,a){"use strict";a.d(s,{default:function(){return t.a}});var l=a(231),t=a.n(l)},16950:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return S}});var l=a(57437),t=a(2265),i=a(92566),r=a(54142),c=a(2842),n=a(9542),d=a(16638),x=a(84478),o=a(28997),h=a(3956),j=(0,x.z)({chartName:"BarChart",GraphicalChild:o.$,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:c.K},{axisType:"yAxis",AxisComp:n.B}],formatAxisMap:h.t9}),m=a(61876),f=a(48185),N=a(2128),u=a(89733),p=a(86763),g=a(87138);let v={CHINESE:"语文",MATH:"数学",ENGLISH:"英语"},b=["0-59","60-69","70-79","80-89","90-100"],y={CHINESE:{label:"语文",color:"hsl(var(--chart-1))"},MATH:{label:"数学",color:"hsl(var(--chart-2))"},ENGLISH:{label:"英语",color:"hsl(var(--chart-3))"}};function S(){let{toast:e}=(0,p.pm)(),[s,a]=(0,t.useState)([]),[x,h]=(0,t.useState)(""),[S,E]=(0,t.useState)(null),[H,k]=(0,t.useState)(!1);(0,t.useEffect)(()=>{w()},[]);let w=async()=>{try{let e=await fetch("/api/classes");if(e.ok){let s=await e.json();a(s)}}catch(e){console.error("加载班级列表失败:",e)}},I=async s=>{k(!0);try{let a=await fetch("/api/analytics/class?classId=".concat(s));if(a.ok){let e=await a.json();E(e)}else e({title:"加载失败",description:"加载分析数据失败",variant:"destructive"})}catch(s){console.error("加载分析数据失败:",s),e({title:"网络错误",description:"网络连接失败，请重试",variant:"destructive"})}finally{k(!1)}},L=(()=>{if(!S)return[];let e=[],{examSubjectAverages:s,exams:a}=S;for(let l of a){let a=l.id.toString();s[a]&&e.push({examName:l.name,examDate:l.date,...s[a]})}return e.sort((e,s)=>new Date(e.examDate).getTime()-new Date(s.examDate).getTime())})(),C=(()=>{if(!S)return[];let e=[],{scoreDistribution:s,exams:a}=S;if(a.length>0){let l=a[0],t=["CHINESE","MATH","ENGLISH"];for(let a=0;a<b.length;a++){let i={range:b[a]};for(let e of t){let t="".concat(l.id,"-").concat(e);s[t]&&(i[e]=s[t][a])}e.push(i)}}return e})();return(0,l.jsxs)("div",{className:"container mx-auto p-6",children:[(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold",children:"班级成绩分析"}),(0,l.jsx)(g.default,{href:"/",children:(0,l.jsx)(u.z,{variant:"outline",children:"返回首页"})})]}),(0,l.jsx)("div",{className:"w-full max-w-md",children:(0,l.jsxs)(N.Ph,{value:x,onValueChange:e=>{h(e),e?I(e):E(null)},children:[(0,l.jsx)(N.i4,{children:(0,l.jsx)(N.ki,{placeholder:"选择班级"})}),(0,l.jsx)(N.Bw,{children:s.map(e=>(0,l.jsxs)(N.Ql,{value:e.id.toString(),children:[e.name," (",e.students.length,"人)"]},e.id))})]})})]}),H&&(0,l.jsx)(f.Zb,{children:(0,l.jsx)(f.aY,{className:"p-6",children:(0,l.jsx)("div",{className:"text-center",children:"加载分析数据中..."})})}),S&&(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)(f.Zb,{children:[(0,l.jsx)(f.Ol,{children:(0,l.jsx)(f.ll,{children:"班级信息"})}),(0,l.jsx)(f.aY,{children:(0,l.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"班级名称"}),(0,l.jsx)("p",{className:"font-semibold",children:S.classInfo.name})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"学生人数"}),(0,l.jsxs)("p",{className:"font-semibold",children:[S.totalStudents," 人"]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"考试次数"}),(0,l.jsxs)("p",{className:"font-semibold",children:[S.exams.length," 次"]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"成绩记录"}),(0,l.jsxs)("p",{className:"font-semibold",children:[S.totalScores," 条"]})]})]})})]}),(0,l.jsxs)(f.Zb,{children:[(0,l.jsx)(f.Ol,{children:(0,l.jsx)(f.ll,{children:"科目整体统计"})}),(0,l.jsx)(f.aY,{children:(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(S.subjectStats).map(e=>{let[s,a]=e;return(0,l.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,l.jsx)("h3",{className:"font-semibold text-lg mb-2",children:v[s]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"平均分:"}),(0,l.jsx)("span",{className:"font-semibold text-blue-600",children:a.average})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"最高分:"}),(0,l.jsx)("span",{className:"font-semibold text-green-600",children:a.highest})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"最低分:"}),(0,l.jsx)("span",{className:"font-semibold text-red-600",children:a.lowest})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{className:"text-gray-600",children:"记录数:"}),(0,l.jsx)("span",{className:"font-semibold",children:a.count})]})]})]},s)})})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,l.jsxs)(f.Zb,{children:[(0,l.jsx)(f.Ol,{children:(0,l.jsx)(f.ll,{children:"班级平均分趋势"})}),(0,l.jsx)(f.aY,{children:(0,l.jsx)(m.BO,{config:y,className:"h-[300px]",children:(0,l.jsxs)(i.w,{accessibilityLayer:!0,data:L,margin:{left:12,right:12},children:[(0,l.jsx)(r.q,{vertical:!1}),(0,l.jsx)(c.K,{dataKey:"examName",tickLine:!1,axisLine:!1,tickMargin:8,tickFormatter:e=>e.slice(0,3)}),(0,l.jsx)(n.B,{domain:[0,100],tickLine:!1,axisLine:!1,tickMargin:8}),(0,l.jsx)(m.h7,{cursor:!1,content:(0,l.jsx)(m.dg,{})}),(0,l.jsx)(d.x,{dataKey:"CHINESE",type:"monotone",stroke:"var(--color-CHINESE)",strokeWidth:2,dot:!1,label:{fontSize:12,fill:"var(--color-CHINESE)"}}),(0,l.jsx)(d.x,{dataKey:"MATH",type:"monotone",stroke:"var(--color-MATH)",strokeWidth:2,dot:!1,label:{fontSize:12,fill:"var(--color-MATH)"}}),(0,l.jsx)(d.x,{dataKey:"ENGLISH",type:"monotone",stroke:"var(--color-ENGLISH)",strokeWidth:2,dot:!1,label:{fontSize:12,fill:"var(--color-ENGLISH)"}}),(0,l.jsx)(m.Qk,{content:(0,l.jsx)(m.cD,{})})]})})})]}),C.length>0&&(0,l.jsxs)(f.Zb,{children:[(0,l.jsx)(f.Ol,{children:(0,l.jsx)(f.ll,{children:"最近考试成绩分布"})}),(0,l.jsx)(f.aY,{children:(0,l.jsx)(m.BO,{config:y,className:"h-[300px]",children:(0,l.jsxs)(j,{accessibilityLayer:!0,data:C,margin:{left:12,right:12},children:[(0,l.jsx)(r.q,{vertical:!1}),(0,l.jsx)(c.K,{dataKey:"range",tickLine:!1,axisLine:!1,tickMargin:8}),(0,l.jsx)(n.B,{tickLine:!1,axisLine:!1,tickMargin:8}),(0,l.jsx)(m.h7,{cursor:!1,content:(0,l.jsx)(m.dg,{})}),(0,l.jsx)(o.$,{dataKey:"CHINESE",fill:"var(--color-CHINESE)",radius:4,label:{fontSize:12,fill:"var(--color-CHINESE)"}}),(0,l.jsx)(o.$,{dataKey:"MATH",fill:"var(--color-MATH)",radius:4,label:{fontSize:12,fill:"var(--color-MATH)"}}),(0,l.jsx)(o.$,{dataKey:"ENGLISH",fill:"var(--color-ENGLISH)",radius:4,label:{fontSize:12,fill:"var(--color-ENGLISH)"}}),(0,l.jsx)(m.Qk,{content:(0,l.jsx)(m.cD,{})})]})})})]})]}),(0,l.jsxs)(f.Zb,{children:[(0,l.jsx)(f.Ol,{children:(0,l.jsx)(f.ll,{children:"考试历史"})}),(0,l.jsx)(f.aY,{children:(0,l.jsx)("div",{className:"space-y-2",children:S.exams.map(e=>(0,l.jsxs)("div",{className:"flex justify-between items-center p-3 border rounded-lg",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-semibold",children:e.name}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:new Date(e.date).toLocaleDateString()})]}),(0,l.jsx)("div",{className:"text-right",children:S.examSubjectAverages[e.id.toString()]&&(0,l.jsx)("div",{className:"space-y-1",children:Object.entries(S.examSubjectAverages[e.id.toString()]).map(e=>{let[s,a]=e;return(0,l.jsxs)("div",{className:"text-sm",children:[(0,l.jsxs)("span",{className:"text-gray-600",children:[v[s],":"]}),(0,l.jsx)("span",{className:"ml-1 font-semibold",children:a})]},s)})})})]},e.id))})})]})]}),!x&&!H&&(0,l.jsx)(f.Zb,{children:(0,l.jsx)(f.aY,{className:"p-6",children:(0,l.jsx)("div",{className:"text-center text-gray-500",children:"请选择一个班级查看详细的成绩分析"})})})]})}}},function(e){e.O(0,[314,402,115,231,989,960,971,23,744],function(){return e(e.s=67756)}),_N_E=e.O()}]);